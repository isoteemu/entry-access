{{define "title"}}Login - Door Entry System{{end}}

{{define "content"}}
<div class="flex min-h-full flex-col justify-center py-12 sm:px-6 lg:px-8">
    <div class="sm:mx-auto sm:w-full sm:max-w-md">
        <!-- Logo/Header -->
        <div class="flex items-center gap-4 mb-2">
            <div class="h-12 w-12 flex items-center justify-center bg-blue-600 dark:bg-blue-500 rounded-lg">
                <svg class="h-8 w-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
            </div>
            <h2 class="text-3xl font-bold tracking-tight text-gray-900 dark:text-white flex-1 text-center">
                Identify with email
            </h2>
        </div>
        <p class="mt-2 text-center text-sm">
            To access the premises, please enter your student email registered in Sisu. A login link will be sent to your email.
        </p>
    </div>

    <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
        <div class="bg-white dark:bg-gray-800 px-4 py-8 shadow sm:rounded-lg sm:px-10">

            <!-- Server-side error (rendered by backend) -->
            <div id="server-error" class="{{ if .Error }}mt-4{{ else }}hidden{{ end }}">
                <div class="rounded-md bg-red-50 dark:bg-red-900/20 p-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.72-1.36 3.485 0l6.518 11.59c.75 1.334-.213 2.994-1.742 2.994H3.481c-1.529 0-2.492-1.66-1.742-2.994L8.257 3.1zM11 13a1 1 0 10-2 0 1 1 0 002 0zm-1-8a1 1 0 00-.993.883L9 6v4a1 1 0 001.993.117L11 10V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-red-800 dark:text-red-200" id="server-error-content">
                                {{ if .Error }}
                                    {{ .Error }}
                                {{ end }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step indicator -->
            <div class="flex items-center mb-6">
                <div class="flex items-center justify-center h-8 w-8 rounded-full bg-blue-600 text-white font-bold mr-3">
                    1
                </div>
                <h3 class="text-base font-medium text-gray-900 dark:text-white">Enter your student email</h3>
            </div>
            <form class="space-y-6" action="" method="POST" id="email-form">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                        Email address
                    </label>
                    <div class="mt-1">
                        <input 
                            id="email" 
                            name="email" 
                            type="email"
                            autocomplete="email" 
                            required
                            class="block w-full appearance-none rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 placeholder-gray-400 dark:placeholder-gray-500 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm"
                            placeholder="Enter your email"
                        >
                    </div>
                </div>

                <div>
                    <button 
                        type="submit" 
                        class="flex w-full justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                    >
                        Send login link
                    </button>
                </div>
                <input type="hidden" name="redirect" value="{{.Redirect}}">
                <input type="hidden" name="timezone" id="timezone" value="">
            </form>


            <div id="otp-container" class="{{ if not .OTPClaim}}hidden{{end}} mt-6">
                <div id="hr" class="mt-6 border-t border-gray-200 dark:border-gray-700"></div>
                <a name="OTP" class="hidden">OTP Verification</a>
                <div class="flex items-center mt-6 mb-4">
                    <div class="flex items-center justify-center h-8 w-8 rounded-full bg-blue-600 text-white font-bold mr-3">
                        2
                    </div>
                    <h3 class="text-base font-medium text-gray-900 dark:text-white">Check your email</h3>
                </div>

                <!-- Email Status messages -->
                <div id="message" class="mt-4 mb-4">
                    <div class="rounded-md bg-green-50 dark:bg-green-900/20 p-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-green-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                </svg>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-medium text-green-800 dark:text-green-200">
                                    Check your email for a login link. If you don't see it, please check your spam folder. The link will expire in {{.LinkTTL}} minutes.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <p class="text-sm text-gray-600 dark:text-gray-400">
                    You can use the login link sent to your email and ignore this page, or you can fill out here the authentication code included in the email.
                </p>
                <form class="mt-4 flex flex-col items-center" action="verify" method="POST" autocomplete="off" id="otp-form">
                    <label for="otp" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Enter 6-digit code
                    </label>
                    <div class="mt-1">
                        <input
                            id="otp"
                            name="otp"
                            type="text"
                            inputmode="numeric"
                            pattern="[0-9]{6}"
                            maxlength="6"
                            minlength="6"
                            required
                            class="block w-40 text-center appearance-none rounded-md border border-gray-300 dark:border-gray-600 px-3 py-2 placeholder-gray-400 dark:placeholder-gray-500 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-blue-500 dark:bg-gray-700 dark:text-white sm:text-sm tracking-widest"
                            placeholder="_ _ _ _ _ _"
                        >
                    </div>

                    <button
                        type="submit"
                        class="mt-3 flex w-40 justify-center rounded-md border border-transparent bg-blue-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                        Verify and proceed
                    </button>

                    <input type="hidden" name="otpclaim" value="{{.OTPClaim}}">
                </form>
            </div>

        </div>
    </div>
</div>
{{end}}

{{define "scripts"}}
<script type="module">
import * as main from '/assets/js/email-login.js';
</script>
{{end}}

{{template "base" .}}